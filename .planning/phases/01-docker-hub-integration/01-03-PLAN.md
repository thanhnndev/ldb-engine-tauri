---
phase: "01-docker-hub-integration"
plan: "03"
type: "execute"
wave: 3
depends_on:
  - "01-02"
files_modified:
  - "src/lib/types.ts"
  - "src/lib/components/ImageCard.svelte"
  - "src/lib/components/TagList.svelte"
  - "src/lib/components/PullProgress.svelte"
  - "src/routes/+page.svelte"
autonomous: true

must_haves:
  truths:
    - "User can view available tags for PostgreSQL from Docker Hub"
    - "User can view available tags for Redis from Docker Hub"
    - "User can view available tags for MySQL from Docker Hub"
    - "User can view available tags for MongoDB from Docker Hub"
    - "User can select a specific image version"
    - "User can see real-time download progress when pulling images"
  artifacts:
    - path: "src/lib/types.ts"
      provides: "TypeScript types for images and tags"
      exports: ["ImageTag", "PullProgress", "SupportedImage"]
    - path: "src/lib/components/ImageCard.svelte"
      provides: "Image selection UI component"
      contains: "ImageCard"
    - path: "src/lib/components/TagList.svelte"
      provides: "Tag list display and selection"
      contains: "TagList"
    - path: "src/lib/components/PullProgress.svelte"
      provides: "Pull progress display"
      contains: "PullProgress"
    - path: "src/routes/+page.svelte"
      provides: "Main page integrating all components"
      contains: "database selection"
  key_links:
    - from: "+page.svelte"
      to: "commands/images.rs"
      via: "invoke get_docker_tags"
      pattern: "invoke.*get_docker_tags"
    - from: "+page.svelte"
      to: "commands/images.rs"
      via: "invoke pull_docker_image"
      pattern: "invoke.*pull_docker_image"
    - from: "PullProgress.svelte"
      to: "docker/client.rs"
      via: "listen pull-progress"
      pattern: "listen.*pull-progress"
---

<objective>
Create frontend UI components for viewing Docker Hub image tags, selecting versions, and displaying pull progress.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/routes/+page.svelte
@src/lib/types.ts

# Frontend structure:
# - Use Svelte 5 runes ($state, $derived)
# - Tailwind CSS is available (check if configured)
# - Tauri invoke() for backend commands
# - Tauri event listener for pull progress

# UI Requirements:
# - Display 4 database options (PostgreSQL, Redis, MySQL, MongoDB)
# - Show loading state while fetching tags
# - Display tags in scrollable list
# - Allow selecting a specific tag/version
# - Show pull progress with status messages
</context>

<tasks>

<task type="auto">
  <name>Create TypeScript types</name>
  <files>src/lib/types.ts</files>
  <action>
Create TypeScript types for the Docker image functionality:

```typescript
export interface ImageTag {
  name: string;
}

export interface SupportedImage {
  id: string;
  name: string;
  hubName: string;
  description: string;
}

export interface PullProgress {
  id: string;
  status: string;
  progress?: string;
  progress_detail?: {
    current?: number;
    total?: number;
  };
}

export const SUPPORTED_IMAGES: SupportedImage[] = [
  { 
    id: 'postgres', 
    name: 'PostgreSQL', 
    hubName: 'library/postgres',
    description: 'Advanced open source database'
  },
  { 
    id: 'redis', 
    name: 'Redis', 
    hubName: 'library/redis',
    description: 'In-memory data structure store'
  },
  { 
    id: 'mysql', 
    name: 'MySQL', 
    hubName: 'library/mysql',
    description: 'Popular relational database'
  },
  { 
    id: 'mongo', 
    name: 'MongoDB', 
    hubName: 'library/mongo',
    description: 'NoSQL document database'
  },
];
```
  </action>
  <verify>
TypeScript compilation passes
  </verify>
  <done>Types exported from src/lib/types.ts</done>
</task>

<task type="auto">
  <name>Create ImageCard component</name>
  <files>src/lib/components/ImageCard.svelte</files>
<action>
Create the ImageCard component for displaying database options:

```svelte
<script lang="ts">
  import type { SupportedImage } from '$lib/types';

  interface Props {
    image: SupportedImage;
    selected: boolean;
    loading: boolean;
    ontoggle: () => void;
  }

  let { image, selected, loading, ontoggle }: Props = $props();
</script>

<button
  class="image-card"
  class:selected
  onclick={ontoggle}
  disabled={loading}
>
  <div class="icon">
    {#if image.id === 'postgres'}
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"/>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
      </svg>
    {:else if image.id === 'redis'}
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
        <path d="M8 12a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"/>
      </svg>
    {:else if image.id === 'mysql'}
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
        <path d="M2 17l10 5 10-5"/>
        <path d="M2 12l10 5 10-5"/>
      </svg>
    {:else}
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 17l6-6-6-6"/>
        <path d="M12 17h8"/>
      </svg>
    {/if}
  </div>
  <h3>{image.name}</h3>
  <p>{image.description}</p>
</button>

<style>
  .image-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 160px;
  }
  
  .image-card:hover:not(:disabled) {
    border-color: #3b82f6;
    transform: translateY(-2px);
  }
  
  .image-card.selected {
    border-color: #2563eb;
    background: #eff6ff;
  }
  
  .image-card:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  .icon {
    margin-bottom: 0.5rem;
    color: #3b82f6;
  }
  
  h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
  }
  
  p {
    margin: 0.25rem 0 0;
    font-size: 0.85rem;
    color: #6b7280;
    text-align: center;
  }
</style>
```
  </action>
  <verify>
npm run check passes (if configured)
  </verify>
  <done>ImageCard component renders database selection</done>
</task>

<task type="auto">
  <name>Create TagList component</name>
  <files>src/lib/components/TagList.svelte</files>
<action>
Create the TagList component for displaying and selecting image tags:

```svelte
<script lang="ts">
  import type { ImageTag } from '$lib/types';

  interface Props {
    tags: ImageTag[];
    selectedTag: string | null;
    loading: boolean;
    onselect: (tag: string) => void;
  }

  let { tags, selectedTag, loading, onselect }: Props = $props();
</script>

<div class="tag-list">
  <h4>Available Versions</h4>
  
  {#if loading}
    <div class="loading">
      <span class="spinner"></span>
      Loading tags...
    </div>
  {:else if tags.length === 0}
    <p class="empty">No tags available</p>
  {:else}
    <div class="tags">
      {#each tags as tag}
        <button
          class="tag"
          class:selected={selectedTag === tag.name}
          onclick={() => onselect(tag.name)}
        >
          {tag.name}
        </button>
      {/each}
    </div>
  {/if}
</div>

<style>
  .tag-list {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    background: white;
  }
  
  h4 {
    margin: 0 0 0.75rem;
    font-size: 0.9rem;
    font-weight: 600;
    color: #374151;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .loading {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #6b7280;
    font-size: 0.9rem;
  }
  
  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #e5e7eb;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  .empty {
    color: #9ca3af;
    font-size: 0.9rem;
    margin: 0;
  }
  
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .tag {
    padding: 0.35rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: #f9fafb;
    font-size: 0.85rem;
    color: #374151;
    cursor: pointer;
    transition: all 0.15s ease;
  }
  
  .tag:hover {
    border-color: #3b82f6;
    background: #eff6ff;
  }
  
  .tag.selected {
    border-color: #2563eb;
    background: #3b82f6;
    color: white;
  }
</style>
```
  </action>
  <verify>
npm run check passes (if configured)
  </verify>
  <done>TagList component displays and selects tags</done>
</task>

<task type="auto">
<name>Create PullProgress component</name>
<files>src/lib/components/PullProgress.svelte</files>
<action>
Create the PullProgress component for displaying pull status:

```svelte
<script lang="ts">
  import { listen } from '@tauri-apps/api/event';
  import { onMount, onDestroy } from 'svelte';
  import type { PullProgress } from '$lib/types';

  interface Props {
    image: string;
    oncomplete: () => void;
    oncancel: () => void;
  }

  let { image, oncomplete, oncancel }: Props = $props();

  let progress: PullProgress[] = $state([]);
  let currentStatus = $state('Preparing...');
  let isComplete = $state(false);
  let isError = $state(false);
  let errorMessage = $state('');
  let unlisten: (() => void) | null = null;
  let unlistenComplete: (() => void) | null = null;
  let unlistenError: (() => void) | null = null;

  onMount(async () => {
    // Listen for pull progress events
    unlisten = await listen<PullProgress>('pull-progress', (event) => {
      const p = event.payload;
      progress = [...progress, p];
      currentStatus = p.status;
      
      if (p.progress) {
        currentStatus = `${p.status}: ${p.progress}`;
      }
    });

    // Listen for pull completion
    unlistenComplete = await listen<string>('pull-complete', () => {
      isComplete = true;
      currentStatus = 'Pull complete!';
      oncomplete();
    });

    // Listen for pull errors
    unlistenError = await listen<string>('pull-error', (event) => {
      isError = true;
      errorMessage = event.payload;
      currentStatus = 'Error';
    });
  });

  onDestroy(() => {
    unlisten?.();
    unlistenComplete?.();
    unlistenError?.();
  });
</script>

<div class="pull-progress">
  <div class="header">
    <h4>Pulling {image}</h4>
    {#if !isComplete && !isError}
      <button class="cancel-btn" onclick={oncancel}>Cancel</button>
    {/if}
  </div>
  
  <div class="status" class:error={isError} class:complete={isComplete}>
    {#if isError}
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
    {:else if isComplete}
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    {:else}
      <span class="spinner"></span>
    {/if}
    <span>{currentStatus}</span>
  </div>
  
  {#if isError}
    <p class="error-message">{errorMessage}</p>
  {/if}
  
  {#if progress.length > 0 && !isComplete && !isError}
    <div class="progress-details">
      {#each progress.slice(-5) as p}
        <div class="progress-item">
          <span class="layer">{p.id || 'Layer'}</span>
          <span class="layer-status">{p.status}</span>
        </div>
      {/each}
    </div>
  {/if}
</div>

<style>
  .pull-progress {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    background: white;
  }
  
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }
  
  h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
  }
  
  .cancel-btn {
    padding: 0.25rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
    font-size: 0.85rem;
    color: #6b7280;
    cursor: pointer;
  }
  
  .cancel-btn:hover {
    background: #f3f4f6;
  }
  
  .status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #374151;
  }
  
  .status.complete {
    background: #ecfdf5;
    color: #059669;
  }
  
  .status.error {
    background: #fef2f2;
    color: #dc2626;
  }
  
  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #e5e7eb;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  .error-message {
    margin: 0.5rem 0 0;
    font-size: 0.85rem;
    color: #dc2626;
  }
  
  .progress-details {
    margin-top: 0.75rem;
    font-size: 0.8rem;
    color: #6b7280;
  }
  
  .progress-item {
    display: flex;
    justify-content: space-between;
    padding: 0.25rem 0;
    border-bottom: 1px solid #f3f4f6;
  }
  
  .progress-item:last-child {
    border-bottom: none;
  }
  
  .layer {
    font-weight: 500;
  }
</style>
```
  </action>
  <verify>
npm run check passes (if configured)
  </verify>
  <done>PullProgress component displays pull status</done>
</task>

<task type="auto">
<name>Update main page with Docker Hub integration</name>
  <files>src/routes/+page.svelte</files>
<action>
Update the main page to integrate all components:

```svelte
<script lang="ts">
  import { invoke } from "@tauri-apps/api/core";
  import { SUPPORTED_IMAGES, type ImageTag, type PullProgress } from "$lib/types";
  import ImageCard from "$lib/components/ImageCard.svelte";
  import TagList from "$lib/components/TagList.svelte";
  import PullProgress from "$lib/components/PullProgress.svelte";

  let selectedImage = $state<string | null>(null);
  let tags = $state<ImageTag[]>([]);
  let selectedTag = $state<string | null>(null);
  let loadingTags = $state(false);
  let pulling = $state(false);
  let pullComplete = $state(false);

  async function loadTags(imageHubName: string) {
    loadingTags = true;
    tags = [];
    selectedTag = null;
    
    try {
      tags = await invoke<ImageTag[]>("get_docker_tags", { image: imageHubName });
    } catch (e) {
      console.error("Failed to load tags:", e);
      tags = [];
    } finally {
      loadingTags = false;
    }
  }

  function selectImage(id: string) {
    const image = SUPPORTED_IMAGES.find(img => img.id === id);
    if (image) {
      selectedImage = id;
      loadTags(image.hubName);
      pullComplete = false;
    }
  }

  function selectTag(tag: string) {
    selectedTag = tag;
  }

  async function pullImage() {
    const image = SUPPORTED_IMAGES.find(img => img.id === selectedImage);
    if (!image || !selectedTag) return;
    
    pulling = true;
    try {
      await invoke("pull_docker_image", { image: `${image.hubName}:${selectedTag}` });
    } catch (e) {
      console.error("Pull failed:", e);
    } finally {
      pulling = false;
    }
  }

  function onPullComplete() {
    pullComplete = true;
  }

  function cancelPull() {
    pulling = false;
  }

  function reset() {
    selectedImage = null;
    tags = [];
    selectedTag = null;
    pulling = false;
    pullComplete = false;
  }

  let fullImageName = $derived(
    selectedImage && selectedTag 
      ? `${SUPPORTED_IMAGES.find(i => i.id === selectedImage)?.hubName}:${selectedTag}`
      : ''
  );
</script>

<main class="container">
  <h1>LDB-Engine</h1>
  <p class="subtitle">Local Database Manager</p>

  {#if !selectedImage}
    <section class="select-image">
      <h2>Select a Database</h2>
      <div class="image-grid">
        {#each SUPPORTED_IMAGES as image}
          <ImageCard 
            {image} 
            selected={selectedImage === image.id}
            loading={false}
            ontoggle={() => selectImage(image.id)}
          />
        {/each}
      </div>
    </section>
  {:else}
    <section class="configure">
      <button class="back-btn" onclick={reset}>
        ‚Üê Back to selection
      </button>
      
      <div class="selected-info">
        <h2>{SUPPORTED_IMAGES.find(i => i.id === selectedImage)?.name}</h2>
        <p class="image-name">{fullImageName}</p>
      </div>

      <TagList 
        {tags} 
        {selectedTag} 
        loading={loadingTags}
        onselect={selectTag}
      />

      {#if pulling}
        <PullProgress 
          image={fullImageName}
          oncomplete={onPullComplete}
          oncancel={cancelPull}
        />
      {:else if pullComplete}
        <div class="success-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <span>Image pulled successfully!</span>
          <button class="pull-again-btn" onclick={() => { pullComplete = false; }}>
            Pull Again
          </button>
        </div>
      {:else if selectedTag}
        <button class="pull-btn" onclick={pullImage}>
          Pull Image
        </button>
      {/if}
    </section>
  {/if}
</main>

<style>
  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  h1 {
    text-align: center;
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0;
  }
  
  .subtitle {
    text-align: center;
    color: #6b7280;
    margin: 0.5rem 0 2rem;
  }
  
  h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #374151;
    margin: 0 0 1rem;
  }
  
  .image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
  }
  
  .select-image {
    margin-top: 2rem;
  }
  
  .configure {
    margin-top: 1rem;
  }
  
  .back-btn {
    padding: 0.5rem 1rem;
    border: none;
    background: none;
    color: #3b82f6;
    font-size: 0.9rem;
    cursor: pointer;
    margin-bottom: 1rem;
  }
  
  .back-btn:hover {
    text-decoration: underline;
  }
  
  .selected-info {
    margin-bottom: 1.5rem;
  }
  
  .selected-info h2 {
    margin-bottom: 0.25rem;
  }
  
  .image-name {
    color: #6b7280;
    font-family: monospace;
    font-size: 0.9rem;
    margin: 0;
  }
  
  .pull-btn {
    width: 100%;
    margin-top: 1.5rem;
    padding: 0.875rem;
    border: none;
    border-radius: 8px;
    background: #3b82f6;
    color: white;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  
  .pull-btn:hover {
    background: #2563eb;
  }
  
  .success-message {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1.5rem;
    padding: 1rem;
    background: #ecfdf5;
    border-radius: 8px;
    color: #059669;
  }
  
  .pull-again-btn {
    margin-left: auto;
    padding: 0.375rem 0.75rem;
    border: none;
    border-radius: 6px;
    background: #059669;
    color: white;
    font-size: 0.85rem;
    cursor: pointer;
  }
</style>
```
  </action>
  <verify>
npm run check passes
  </verify>
  <done>Main page integrates all components for Docker Hub workflow</done>
</task>

</tasks>

<verification>
Frontend compiles. Components render correctly. Tauri commands are invoked properly.
</verification>

<success_criteria>
- [ ] ImageCard displays database selection
- [ ] TagList displays available tags
- [ ] PullProgress shows pull status
- [ ] Main page integrates all components
- [ ] User can select database, view tags, select version, pull image
- [ ] npm run check passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-docker-hub-integration/01-03-SUMMARY.md`
</output>
