---
phase: 03-connection-utilities
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/lib/components/ConnectionString.svelte
  - src/lib/components/InstanceCard.svelte
  - package.json
autonomous: false

must_haves:
  truths:
    - "User can see a connection string for each running instance"
    - "User can copy the connection string with one click"
    - "Copied text matches the displayed connection string exactly"
    - "Connection string is hidden for non-running instances"
  artifacts:
    - path: "src/lib/components/ConnectionString.svelte"
      provides: "Connection string display with copy button"
      min_lines: 40
    - path: "src/lib/components/InstanceCard.svelte"
      provides: "Integration point for connection string"
      contains: "ConnectionString"
  key_links:
    - from: "ConnectionString.svelte"
      to: "get_connection_string command"
      via: "invoke from @tauri-apps/api/core"
      pattern: "invoke.*get_connection_string"
    - from: "ConnectionString.svelte"
      to: "clipboard"
      via: "@tauri-apps/plugin-clipboard-manager"
      pattern: "writeText"
    - from: "InstanceCard.svelte"
      to: "ConnectionString"
      via: "component import"
      pattern: "import.*ConnectionString"
---

<objective>
Create frontend component to display connection strings with one-click copy functionality.

Purpose: Allow users to easily view and copy database connection strings for running instances.
Output: ConnectionString component integrated into InstanceCard with clipboard functionality.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Backend command (from Plan 01)
@.planning/phases/03-connection-utilities/03-01-PLAN.md

# Existing component to integrate with
@src/lib/components/InstanceCard.svelte

# Types
@src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Install clipboard-manager plugin</name>
  <files>package.json</files>
  <action>
Install the Tauri clipboard-manager plugin for the frontend.

Run:
```bash
npm add @tauri-apps/plugin-clipboard-manager
```

This provides the `writeText` function to copy text to the system clipboard.

Note: The Rust-side plugin may need to be added to Cargo.toml as well:
```bash
cd src-tauri && cargo add tauri-plugin-clipboard-manager
```

And register it in lib.rs builder chain:
```rust
.plugin(tauri_plugin_clipboard_manager::init())
```
  </action>
  <verify>
    npm list @tauri-apps/plugin-clipboard-manager && cd src-tauri && cargo tree | grep clipboard
  </verify>
  <done>
Clipboard-manager plugin installed in both frontend and backend, plugin registered in Tauri builder.
  </done>
</task>

<task type="auto">
  <name>Create ConnectionString component</name>
  <files>src/lib/components/ConnectionString.svelte</files>
  <action>
Create `src/lib/components/ConnectionString.svelte` with the following functionality:

1. **Props interface:**
   - `instanceId: string` - the instance ID to fetch connection string for
   - `instanceName: string` - for database name in connection string
   - `databaseType: string` - to show database type icon/badge
   - `port: number` - to display port info
   - `status: string` - only show if 'running'

2. **Behavior:**
   - Only fetch and display connection string when `status === 'running'`
   - Fetch connection string on mount using `invoke('get_connection_string', { instanceId })`
   - Show loading state while fetching
   - Show error state if fetch fails
   - Display connection string in a monospace font with copy button

3. **Copy functionality:**
   - Use `writeText` from `@tauri-apps/plugin-clipboard-manager`
   - Show visual feedback on copy (e.g., "Copied!" text or icon change)
   - Reset feedback after 2 seconds

4. **UI Layout:**
   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Connection String                        [ğŸ“‹ Copy]      â”‚
   â”‚ postgresql://postgres:pass@127.0.0.1:5432/mydb         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

5. **Styling:**
   - Use Tailwind CSS classes consistent with InstanceCard styling
   - Connection string should be in monospace font
   - Copy button should have hover state
   - Show subtle background to distinguish from other content

Example imports:
```typescript
import { invoke } from '@tauri-apps/api/core';
import { writeText } from '@tauri-apps/plugin-clipboard-manager';
```

Use Svelte 5 runes ($state, $effect) for reactivity as established in the project.
  </action>
  <verify>
    npm run check 2>&1 | head -30
  </verify>
  <done>
ConnectionString component compiles, displays connection string, and has copy button with feedback.
  </done>
</task>

<task type="auto">
  <name>Integrate ConnectionString into InstanceCard</name>
  <files>src/lib/components/InstanceCard.svelte</files>
  <action>
Update `src/lib/components/InstanceCard.svelte` to include the ConnectionString component:

1. Import the component:
   ```typescript
   import ConnectionString from './ConnectionString.svelte';
   ```

2. Add ConnectionString component after the `.details` div and before InstanceControls:
   ```svelte
   {#if instance.status === 'running'}
     <ConnectionString 
       instanceId={instance.id}
       instanceName={instance.name}
       databaseType={instance.database_type}
       port={instance.port}
       status={instance.status}
     />
   {/if}
   ```

3. Only show for running instances (connection strings for stopped instances are not useful)

4. Add appropriate spacing/margin between details and connection string section
  </action>
  <verify>
    npm run check 2>&1 | head -30
  </verify>
  <done>
InstanceCard displays ConnectionString component for running instances with proper layout.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete connection string feature:
- Backend command generates connection strings for all 4 database types
- Frontend ConnectionString component displays and copies connection strings
- Integrated into InstanceCard for running instances
  </what-built>
  <how-to-verify>
1. Run `npm run tauri dev` to start the application
2. Start a database instance (or create a new one)
3. Verify the connection string appears on the instance card when running
4. Click the copy button and verify:
   - Visual feedback shows "Copied!" or similar
   - Paste into a text editor confirms correct connection string
5. Stop the instance and verify connection string is hidden
6. Test with different database types (PostgreSQL, Redis, MySQL, MongoDB)
  </how-to-verify>
  <resume-signal>Type "approved" if working correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- npm run check passes
- ConnectionString component exists and compiles
- InstanceCard imports and uses ConnectionString
- Connection string only shows for running instances
- Copy button works and provides feedback
- All 4 database types produce correct connection string formats
</verification>

<success_criteria>
- User can see connection string for any running database instance
- User can copy connection string with single click
- Connection string format is correct for each database type
- UI is clean and consistent with existing design
</success_criteria>

<output>
After completion, create `.planning/phases/03-connection-utilities/03-02-SUMMARY.md`
</output>
