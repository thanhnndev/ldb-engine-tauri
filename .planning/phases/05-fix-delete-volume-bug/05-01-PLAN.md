---
phase: 05-fix-delete-volume-bug
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/components/InstanceList.svelte
autonomous: true
user_setup: []
gap_closure: true

must_haves:
  truths:
    - "InstanceList.svelte passes deleteVolume parameter correctly to deleteInstance"
    - "When user checks 'Delete volume data', the volume is actually deleted"
    - "E2E flow 'Delete Instance with Volume' completes successfully"
  artifacts:
    - path: "src/lib/components/InstanceList.svelte"
      provides: "Passes deleteVolume parameter from InstanceControls to deleteInstance"
      contains: "ondelete={(deleteVolume) => deleteInstance(instance, deleteVolume)}"
  key_links:
    - from: "InstanceControls.svelte"
      to: "InstanceList.svelte"
      via: "ondelete prop"
      pattern: "ondelete\\(deleteVolume\\)"
---

<objective>
Fix GAP-01: Delete Volume Option Ignored - The deleteVolume parameter passed from InstanceControls is being ignored when deleting instances.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/lib/components/InstanceControls.svelte
@src/lib/components/InstanceList.svelte

The flow:
1. InstanceControls has a checkbox "Delete volume data" stored in deleteWithVolume
2. When user confirms delete, InstanceControls calls ondelete(deleteWithVolume)
3. InstanceList passes ondelete prop to InstanceCard -> InstanceControls
4. Currently InstanceList ignores the parameter and always passes false
</context>

<tasks>

<task type="auto">
  <name>Fix deleteVolume parameter passing in InstanceList.svelte</name>
  <files>src/lib/components/InstanceList.svelte</files>
  <action>
    In InstanceList.svelte line 280, change:
    
    FROM: ondelete={() => deleteInstance(instance, false)}
    TO:   ondelete={(deleteVolume) => deleteInstance(instance, deleteVolume)}
    
    This ensures the deleteVolume boolean from InstanceControls checkbox is passed through to the deleteInstance function.
  </action>
  <verify>grep -n "ondelete=" src/lib/components/InstanceList.svelte | grep deleteVolume</verify>
  <done>Line 280 shows: ondelete={(deleteVolume) => deleteInstance(instance, deleteVolume)}</done>
</task>

</tasks>

<verification>
Verify the fix with:
```bash
grep -n "ondelete=" src/lib/components/InstanceList.svelte
```

Expected output should show the deleteVolume parameter being passed:
```
280:           ondelete={(deleteVolume) => deleteInstance(instance, deleteVolume)}
```
</verification>

<success_criteria>
1. The ondelete prop correctly passes deleteVolume to deleteInstance (not hardcoded false)
2. When user checks "Delete volume data" checkbox in InstanceControls, the volume is actually deleted
3. E2E flow "Delete Instance with Volume" can complete successfully
</success_criteria>

<output>
After completion, create `.planning/phases/05-fix-delete-volume-bug/05-01-SUMMARY.md`
</output>
